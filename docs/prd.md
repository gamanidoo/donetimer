# 🕒 Circle Timer – 시간 정책 중심 PRD

버전: v1.1  
작성자: PM garamkim  
최종 수정일: 2025-05-08

---

## 1. 📌 목적 (Goal)

사용자가 종료 시각을 설정하고, 그 시각까지의 집중 시간을 시각적으로 인식하며 집중 흐름을 관리할 수 있도록 하는 원형 타이머 기능을 구현한다.  
모든 시간은 시:분 단위로 노출되며, 초 단위는 계산/표현 모두에서 제외된다.  
타이머 시작 후 새로고침 시 데이터 초기화 알림을 통해 UX 혼란을 방지한다.

---

## 2. 🧩 주요 시간 정의 및 계산 로직

| 항목 | 정의 | 고정 여부 | 계산 시점 | 표시 형식 |
|------|------|-----------|------------|------------|
| 시작 시각 | 타이머 시작 전: 현재 시각<br>타이머 시작 후: 시작 버튼 클릭 시점 | 시작 전: 🔄<br>시작 후: ✅ | 시작 전: 실시간<br>시작 후: 1회 | `HH:mm` |
| 종료 시각 | 사용자가 타임피커에서 선택한 시각 | ✅ 고정 | 타임피커 입력 시 | `HH:mm` |
| 집중 시간 | 시작 전: 현재~종료<br>시작 후: 시작~종료 시각 | ✅ 고정 | 시작 전: 실시간<br>시작 후: 1회 | `N시간 N분` |
| 경과 시간 | 타이머 시작 후 현재까지 흐른 시간 | 🔄 실시간 | 1분 미만: 1초 간격<br>1분 이상: 1분 간격 | 1분 미만: `N초`<br>1분 이상: `N시간 N분` |
| 남은 시간 | 현재 시각부터 종료 시각까지 남은 시간 | 🔄 실시간 | 1분 간격 갱신 | `N시간 N분` |

> 시간 계산 상세:
> 1. 시작 시각 결정:
>    - 시작 전: `new Date()`로 현재 시각 실시간 반영 (초와 밀리초는 0으로 설정)
>    - 시작 후: `startTime` 상태값으로 고정 (시작 시점의 초와 밀리초는 0으로 설정)
> 2. 종료 시각 설정:
>    ```typescript
>    const now = new Date();
>    const endTime = new Date();
>    endTime.setHours(hours, minutes, 0, 0);  // 초와 밀리초는 항상 0으로 설정
>    if (endTime < now) endTime.setDate(endTime.getDate() + 1);
>    ```
> 3. 집중 시간 계산:
>    ```typescript
>    // 시작 전/후 모두 초와 밀리초는 0으로 설정하여 계산
>    const baseTime = isRunning ? startTime : new Date().setSeconds(0, 0);
>    const focusMinutes = differenceInMinutes(endTime, baseTime);
>    ```
> 4. 남은 시간 계산:
>    ```typescript
>    // 현재 시각의 초와 밀리초를 0으로 설정하여 계산
>    const now = new Date();
>    now.setSeconds(0, 0);
>    const leftMinutes = differenceInMinutes(endTime, now);
>    ```
>
> 시간 계산 시 주의사항:
> - 모든 시간 계산에서 초와 밀리초는 0으로 설정하여 일관성 유지
> - 시작 전/후의 집중 시간이 동일하게 표시되도록 보장
> - 시간 업데이트는 1분 단위로 수행

---

## 3. ⏱ 타이머 동작 흐름

1. 사용자가 타임피커로 종료 시각을 설정
2. 타이머 **시작 전**: 시작 시각은 현재 시각 기준으로 1분 단위로 실시간 반영
3. 타이머 **시작 버튼 클릭 시점**에 시작 시각을 고정하고, 집중 시간 계산
4. 타이머 작동 중에는 경과 시간, 남은 시간을 1분 단위로 갱신
5. 종료 시각 도달 시:
   - 남은 시간은 0분
   - `"🎉 집중 완료!"` 메시지 표시
6. 타이머 작동 중 새로고침 시:
   - `"타이머가 초기화됩니다. 다시 시작할까요?"` 알림 노출 후 재설정 유도

---

## 4. 🎨 UI 정책

| 항목 | 표시/행동 |
|------|-----------|
| 시작 시각 | 타이머 시작 전에는 회색 텍스트로 현재 시각 표시 → 시작 시 고정 |
| 종료 시각 | 타임피커 입력값 고정 표시. 시작 후에는 수정 불가 |
| 집중 시간 | 종료 시각 - 시작 시각 계산 결과를 `"N시 N분"` 형식으로 표시 |
| 경과 시간 | 시작 후 1분마다 `"N시 N분"` 갱신 |
| 남은 시간 | 현재 시각 기준 `"N시 N분"` 갱신. 0이 되면 완료 메시지 |
| 새로고침 시 | `window.onbeforeunload`으로 경고창 노출 |
| 시각 형식 | 24시간제 `13:45` 형식. AM/PM 미사용 |

### TimerHeader 상태별 표시 정책

| 상태 | 표시 텍스트 | 계산 기준 |
|------|------------|------------|
| 초기 상태 | "종료 시각을 선택하세요" | - |
| 시각 입력 완료 | "{N}시간 {N}분 집중하기" | 시작 시각 ~ 종료 시각 |
| 타이머 작동 중 | "{HH:mm}까지, {N}시간 {N}분동안 집중해요" | 시작 시각 ~ 종료 시각 |
| 타이머 완료 | "완료!" | - |

> 시간 표시 예시:
> 1. 시작 전 (현재 15:55, 종료 16:00 설정):
>    - 시작 시각: "15:55" (실시간 업데이트)
>    - 종료 시각: "16:00" (고정)
>    - 헤더: "5분 집중하기"
> 2. 시작 후:
>    - 시작 시각: "15:55" (고정)
>    - 종료 시각: "16:00" (고정)
>    - 헤더: "16:00까지, 5분동안 집중해요"

### TimerButton 상태별 표시 정책

| 상태 | 표시 버튼 | 스타일 | 동작 |
|------|-----------|--------|------|
| 종료 시각 미입력 | 시작하기 (비활성화) | 회색 배경, 비활성화 | 클릭 불가 |
| 종료 시각 입력 완료 | 시작하기 (활성화) | 파란색 배경, 활성화 | 타이머 시작 |
| 타이머 작동 중 | 초기화 | 빨간색 배경 | 초기화 확인 얼럿 표시 |
| 타이머 완료 | 초기화 | 빨간색 배경 | 초기화 확인 얼럿 표시 |

> 초기화 버튼 클릭 시 확인 얼럿:
> - 메시지: "타이머를 초기화하시겠습니까?"
> - 확인: "예" → 타이머 초기화
> - 취소: "아니오" → 얼럿 닫기

### TimerInfo 시간 표시 정책

| 항목 | 계산 방식 | 표시 형식 | 갱신 주기 |
|------|-----------|-----------|-----------|
| 보낸 시간 | 전체 집중시간 - 남은 시간 | "N시간 N분" | 1분 |
| 남은 시간 | 종료 시각 - 현재 시각 | "N시간 N분" | 1분 |

### CircleTimer 진행률 표시 정책

| 항목 | 정의 | 계산 방식 | 갱신 주기 |
|------|------|-----------|-----------|
| 진행률 | 전체 시간 대비 경과 시간의 비율 | `(현재시각 - 시작시각) / (종료시각 - 시작시각) * 100` | 1분 미만: 1초<br>1분 이상: 1분 |
| 원형 그래프 | 진행률에 따른 원형 채움 | `360도 * (진행률 / 100)` | 진행률과 동일 |
| 퍼센트 표시 | 진행률의 정수부 표시 | `Math.floor(진행률)` | 진행률과 동일 |

> 진행률 계산 상세:
> 1. 시간 단위: 밀리초(ms) 기준으로 계산
> 2. 계산식: `(현재시각.getTime() - 시작시각.getTime()) / (종료시각.getTime() - 시작시각.getTime()) * 100`
> 3. 결과 처리:
>    - 소수점 이하 버림 (`Math.floor` 사용)
>    - 100% 초과 방지 (`Math.min(100, 계산값)` 사용)
>    - 음수 방지 (`Math.max(0, 계산값)` 사용)
> 4. 업데이트 주기:
>    - 1분 미만 진행: 1초마다 갱신
>    - 1분 이상 진행: 1분마다 갱신
>    - 종료 시점: 100% 고정

> 시각적 표현:
> 1. 원형 그래프:
>    - 시작 전: 빈 원
>    - 진행 중: 보라색 원호 (#8B95F2)
>    - 완료 시: 초록색 원 (#4ADE80)
> 2. 애니메이션:
>    - 부드러운 전환: `transition-all duration-1000 ease-in-out`
>    - 원호 끝: `strokeLinecap="round"`
> 3. 중앙 텍스트:
>    - 대기 중: "타이머 대기 중"
>    - 진행 중: "N%"
>    - 완료: "완료!"

> 예시 시나리오:
> 1. 4분 타이머 시작 시:
>    - 0초: 0% (빈 원)
>    - 1분: 25% (1/4 원호)
>    - 2분: 50% (1/2 원호)
>    - 3분: 75% (3/4 원호)
>    - 4분: 100% (완전한 원)
> 2. 업데이트 간격:
>    - 0~1분: 매 초마다 갱신
>    - 1분 이후: 매 분마다 갱신

> 시간 계산 예시:
> - 전체 집중시간: 2시간 (120분)
> - 현재 시각: 14:30
> - 종료 시각: 15:30
> - 보낸 시간: 1시간 0분 (60분)
> - 남은 시간: 1시간 0분 (60분)

### 시간 표기 정책

1. 시각 표시 (시:분):
   - 형식: `HH:mm`
   - 예시: "15:30", "16:00"
   - 적용: 시작 시각, 종료 시각

2. 지속 시간 표시:
   - 1시간 미만:
     - 형식: `N분`
     - 예시: "30분", "5분"
   - 1시간 이상:
     - 형식: `N시간 N분`
     - 예시: "1시간 30분", "2시간 0분"

3. 헤더 메시지:
   - 시작 전: "{전체시간} 집중하기"
     - 예시: "30분 집중하기", "1시간 30분 집중하기"
   - 진행 중: "{종료시각}까지 {전체시간} 집중해요"
     - 예시: "16:00까지 30분 집중해요"
   - 완료: "완료!"

4. 진행 상태 표시:
   - 경과 시간: "경과 시간: {지속시간}"
     - 예시: "경과 시간: 5분", "경과 시간: 1시간 5분"
   - 남은 시간: "남은 시간: {지속시간}"
     - 예시: "남은 시간: 25분", "남은 시간: 1시간 25분"

5. 특수 케이스:
   - 1분 미만: "1분 미만"
   - 정각: "0분" 대신 "N시간 0분" 사용
   - 자정 넘김: 다음 날 표시 없이 24시간제 사용

> 예시 시나리오:
> 1. 30분 집중 (16:00~16:30)
>    - 시작 전: "30분 집중하기"
>    - 시작 후: "16:30까지 30분 집중해요"
>    - 10분 후: "경과 시간: 10분 / 남은 시간: 20분"
>
> 2. 1시간 30분 집중 (23:30~01:00)
>    - 시작 전: "1시간 30분 집중하기"
>    - 시작 후: "01:00까지 1시간 30분 집중해요"
>    - 1시간 후: "경과 시간: 1시간 0분 / 남은 시간: 30분"

### 시간 입력 정책

1. 시각 입력:
   - 한 자리 입력:
     - 시간: 0-2 → 그대로 표시
     - 시간: 3-9 → "0N"으로 자동 변환
     - 분: 0-5 → 그대로 표시
     - 분: 6-9 → "0N"으로 자동 변환
   - 두 자리 입력:
     - 시간: 00-23 허용
     - 분: 00-59 허용

2. 자동 변환:
   - 현재 시각보다 이전 시각 입력 시 다음 날로 자동 설정
   - 범위 초과 입력 시 최대값으로 자동 변환 (시간: 23, 분: 59)

3. 유효성 표시:
   - 유효한 입력: 초록색 밑줄
   - 유효하지 않은 입력: 흰색 밑줄
   - 비활성화: 회색

---

## 5. 예외 및 경고 처리

| 상황 | 처리 방식 |
|------|------------|
| 종료 시각이 현재 시각보다 과거 | 시작 버튼 비활성화 + `"종료 시각은 현재보다 늦어야 합니다"` 경고 |
| 타이머 실행 중 새로고침 | `"타이머가 초기화됩니다. 다시 시작할까요?"` 확인창 노출 후 초기화 |
| 시각 표시 오류 | 항상 `Math.floor`로 내림 처리. 시/분 변환시 0분도 표기 (`2시간 0분`) |

---

## 6. 계산 예시

> 타이머 시작 시각: `13:45`  
> 종료 시각: `15:20`

| 현재 시각 | 경과 시간 | 남은 시간 |
|-----------|-----------|------------|
| 13:45 (시작) | 0시간 0분 | 1시간 35분 |
| 14:30 | 0시간 45분 | 0시간 50분 |
| 15:20 | 1시간 35분 | 0시간 0분 (종료)

---

## 7. 개발 참고 사항

- 시간 차 계산: `Date` 객체 기반
- 갱신 주기: `setInterval(() => update(), 60000)`
- 포맷 함수: `formatDuration(minutes: number) => "N시간 N분"`
- 새로고침 감지: `window.onbeforeunload`, 또는 `sessionStorage` 사용 고려
- `localStorage` 또는 백업 기능은 v2에 포함 가능

---

## 8. 향후 확장 방향 (v2 이상)

- 새로고침 시 세션 복구 기능 (`localStorage` 활용)
- 집중 시간 리포트 저장
- 반복 타이머 기능 (뽀모도로 방식)
- 사용자 정의 목표 입력 기능

