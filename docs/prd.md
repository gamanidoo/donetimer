# 🕒 Circle Timer – 시간 정책 중심 PRD

버전: v1.1  
작성자: PM garamkim  
최종 수정일: 2025-05-08

---

## 1. 📌 목적 (Goal)

사용자가 종료 시각을 설정하고, 그 시각까지의 집중 시간을 시각적으로 인식하며 집중 흐름을 관리할 수 있도록 하는 원형 타이머 기능을 구현한다.  
모든 시간은 시:분 단위로 노출되며, 초 단위는 계산/표현 모두에서 제외된다.  
타이머 시작 후 새로고침 시 데이터 초기화 알림을 통해 UX 혼란을 방지한다.

---

## 2. 🧩 주요 시간 정의 및 계산 로직

| 항목 | 정의 | 고정 여부 | 계산 시점 | 표시 형식 |
|------|------|-----------|------------|------------|
| 시작 시각 | 타이머 시작 버튼을 누른 순간의 현재 시각 | ✅ 고정 | 타이머 시작 시점 1회 | `HH:MM` |
| 종료 시각 | 사용자가 타임피커에서 선택한 종료 시각 | ✅ 고정 | 타임피커 입력 시 | `HH:MM` |
| 집중 시간 | 시작 시각부터 종료 시각까지의 총 시간 | ✅ 고정 | 시작 시에 계산 | `N시간 N분` |
| 경과 시간 | 타이머 시작 후 현재까지 흐른 시간 | 🔄 실시간 | 1분 간격 갱신 | `N시 N분` |
| 남은 시간 | 현재 시각부터 종료 시각까지 남은 시간 | 🔄 실시간 | 1분 간격 갱신 | `N시 N분` |

> 시간 계산은 `Math.floor((ms 차이) / 60000)` 기준  
> 결과가 60분 이상이면 `"n시간 n분"`으로 변환하여 표기 (예: 87분 → "1시간 27분")

---

## 3. ⏱ 타이머 동작 흐름

1. 사용자가 타임피커로 종료 시각을 설정
2. 타이머 **시작 전**: 시작 시각은 현재 시각 기준으로 1분 단위로 실시간 반영
3. 타이머 **시작 버튼 클릭 시점**에 시작 시각을 고정하고, 집중 시간 계산
4. 타이머 작동 중에는 경과 시간, 남은 시간을 1분 단위로 갱신
5. 종료 시각 도달 시:
   - 남은 시간은 0분
   - `"🎉 집중 완료!"` 메시지 표시
6. 타이머 작동 중 새로고침 시:
   - `"타이머가 초기화됩니다. 다시 시작할까요?"` 알림 노출 후 재설정 유도

---

## 4. 🎨 UI 정책

| 항목 | 표시/행동 |
|------|-----------|
| 시작 시각 | 타이머 시작 전에는 회색 텍스트로 현재 시각 표시 → 시작 시 고정 |
| 종료 시각 | 타임피커 입력값 고정 표시. 시작 후에는 수정 불가 |
| 집중 시간 | 종료 시각 - 시작 시각 계산 결과를 `"N시 N분"` 형식으로 표시 |
| 경과 시간 | 시작 후 1분마다 `"N시 N분"` 갱신 |
| 남은 시간 | 현재 시각 기준 `"N시 N분"` 갱신. 0이 되면 완료 메시지 |
| 새로고침 시 | `window.onbeforeunload`으로 경고창 노출 |
| 시각 형식 | 24시간제 `13:45` 형식. AM/PM 미사용 |

### TimerHeader 상태별 표시 정책

| 상태 | 표시 텍스트 | 설명 |
|------|------------|------|
| 초기 상태 | "종료 시각을 선택하세요" | 타임피커 종료 시각 입력 전 기본 상태 |
| 시각 입력 완료 | "{N}시간 {N}분 집중하기" | 종료 시각 입력 후, 시작 전 상태 |
| 타이머 작동 중 | "{HH:mm}까지, {N}시간 {N}분 남았어요" | 타이머 실행 중 상태 |
| 타이머 완료 | "🎉 집중 완료!" | 설정한 시간 완료 시 표시 |

### TimerButton 상태별 표시 정책

| 상태 | 표시 버튼 | 스타일 | 동작 |
|------|-----------|--------|------|
| 종료 시각 미입력 | 시작하기 (비활성화) | 회색 배경, 비활성화 | 클릭 불가 |
| 종료 시각 입력 완료 | 시작하기 (활성화) | 파란색 배경, 활성화 | 타이머 시작 |
| 타이머 작동 중 | 초기화 | 빨간색 배경 | 초기화 확인 얼럿 표시 |
| 타이머 완료 | 초기화 | 빨간색 배경 | 초기화 확인 얼럿 표시 |

> 초기화 버튼 클릭 시 확인 얼럿:
> - 메시지: "타이머를 초기화하시겠습니까?"
> - 확인: "예" → 타이머 초기화
> - 취소: "아니오" → 얼럿 닫기

### TimerInfo 시간 표시 정책

| 항목 | 계산 방식 | 표시 형식 | 갱신 주기 |
|------|-----------|-----------|-----------|
| 보낸 시간 | 전체 집중시간 - 남은 시간 | "N시간 N분" | 1분 |
| 남은 시간 | 종료 시각 - 현재 시각 | "N시간 N분" | 1분 |

### CircleTimer 진행률 표시 정책

| 항목 | 정의 | 계산 방식 | 갱신 주기 |
|------|------|-----------|-----------|
| 진행률 | 전체 시간 대비 경과 시간의 비율 | (경과 시간 / 전체 시간) * 100 | 1초 |
| 원형 그래프 | 진행률에 따른 원형 채움 | 360도 * (진행률 / 100) | 1초 |
| 퍼센트 표시 | 진행률의 정수부 표시 | Math.floor(진행률) | 1초 |

> 진행률 표시 예시:
> - 전체 시간: 60분
> - 경과 시간: 15분
> - 진행률: (15 / 60) * 100 = 25%
> - 원형 그래프: 90도 (360 * 0.25)
> - 애니메이션: transition-all duration-1000 ease-in-out

> 시간 계산 예시:
> - 전체 집중시간: 2시간 (120분)
> - 현재 시각: 14:30
> - 종료 시각: 15:30
> - 보낸 시간: 1시간 0분 (60분)
> - 남은 시간: 1시간 0분 (60분)

---

## 5. 예외 및 경고 처리

| 상황 | 처리 방식 |
|------|------------|
| 종료 시각이 현재 시각보다 과거 | 시작 버튼 비활성화 + `"종료 시각은 현재보다 늦어야 합니다"` 경고 |
| 타이머 실행 중 새로고침 | `"타이머가 초기화됩니다. 다시 시작할까요?"` 확인창 노출 후 초기화 |
| 시각 표시 오류 | 항상 `Math.floor`로 내림 처리. 시/분 변환시 0분도 표기 (`2시간 0분`) |

---

## 6. 계산 예시

> 타이머 시작 시각: `13:45`  
> 종료 시각: `15:20`

| 현재 시각 | 경과 시간 | 남은 시간 |
|-----------|-----------|------------|
| 13:45 (시작) | 0시간 0분 | 1시간 35분 |
| 14:30 | 0시간 45분 | 0시간 50분 |
| 15:20 | 1시간 35분 | 0시간 0분 (종료)

---

## 7. 개발 참고 사항

- 시간 차 계산: `Date` 객체 기반
- 갱신 주기: `setInterval(() => update(), 60000)`
- 포맷 함수: `formatDuration(minutes: number) => "N시간 N분"`
- 새로고침 감지: `window.onbeforeunload`, 또는 `sessionStorage` 사용 고려
- `localStorage` 또는 백업 기능은 v2에 포함 가능

---

## 8. 향후 확장 방향 (v2 이상)

- 새로고침 시 세션 복구 기능 (`localStorage` 활용)
- 집중 시간 리포트 저장
- 반복 타이머 기능 (뽀모도로 방식)
- 사용자 정의 목표 입력 기능

